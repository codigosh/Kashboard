class S{static STORAGE_KEY="kashboard_theme";static CLASS_NAME="dark-mode";static init(){let g=localStorage.getItem(this.STORAGE_KEY);if(g==="dark")this.enableDark();else if(g==="light")this.enableLight();else if(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)this.enableDark();else this.enableLight()}static enableDark(){document.documentElement.classList.add(this.CLASS_NAME),localStorage.setItem(this.STORAGE_KEY,"dark"),this.setCookie(this.STORAGE_KEY,"dark",365)}static enableLight(){document.documentElement.classList.remove(this.CLASS_NAME),localStorage.setItem(this.STORAGE_KEY,"light"),this.setCookie(this.STORAGE_KEY,"light",365)}static toggle(){if(document.documentElement.classList.contains(this.CLASS_NAME))this.enableLight();else this.enableDark()}static isDark(){return document.documentElement.classList.contains(this.CLASS_NAME)}static setCookie(g,h,d){let a="";if(d){let m=new Date;m.setTime(m.getTime()+d*24*60*60*1000),a="; expires="+m.toUTCString()}document.cookie=g+"="+(h||"")+a+"; path=/"}}var t=[{code:"en",name:"English",flag:"\uD83C\uDDFA\uD83C\uDDF8"},{code:"zh",name:"简体中文",flag:"\uD83C\uDDE8\uD83C\uDDF3"},{code:"hi",name:"हिन्दी",flag:"\uD83C\uDDEE\uD83C\uDDF3"},{code:"es",name:"Español",flag:"\uD83C\uDDEA\uD83C\uDDF8"},{code:"ar",name:"العربية",flag:"\uD83C\uDDF8\uD83C\uDDE6"},{code:"fr",name:"Français",flag:"\uD83C\uDDEB\uD83C\uDDF7"},{code:"bn",name:"Bengali",flag:"\uD83C\uDDE7\uD83C\uDDE9"},{code:"pt",name:"Português",flag:"\uD83C\uDDF5\uD83C\uDDF9"},{code:"ru",name:"Русский",flag:"\uD83C\uDDF7\uD83C\uDDFA"},{code:"de",name:"Deutsch",flag:"\uD83C\uDDE9\uD83C\uDDEA"},{code:"ja",name:"日本語",flag:"\uD83C\uDDEF\uD83C\uDDF5"},{code:"it",name:"Italiano",flag:"\uD83C\uDDEE\uD83C\uDDF9"},{code:"tr",name:"Turkish",flag:"\uD83C\uDDF9\uD83C\uDDF7"},{code:"ko",name:"한국어",flag:"\uD83C\uDDF0\uD83C\uDDF7"},{code:"id",name:"Indonesian",flag:"\uD83C\uDDEE\uD83C\uDDE9"},{code:"pl",name:"Polski",flag:"\uD83C\uDDF5\uD83C\uDDF1"},{code:"ur",name:"Urdu",flag:"\uD83C\uDDF5\uD83C\uDDF0"},{code:"nl",name:"Nederlands",flag:"\uD83C\uDDF3\uD83C\uDDF1"},{code:"fa",name:"Persian",flag:"\uD83C\uDDEE\uD83C\uDDF7"},{code:"el",name:"Greek",flag:"\uD83C\uDDEC\uD83C\uDDF7"}];class f{currentLanguage="en";cache=new Map;listeners=[];static instance;initialized;constructor(){this.initialized=this.init()}async init(){await this.loadLocale("en");let g=localStorage.getItem("csh_lang"),h=navigator.language.split("-")[0],d="en";if(g&&t.find((a)=>a.code===g))d=g;else if(t.find((a)=>a.code===h))d=h;if(d!=="en")await this.loadLocale(d);this.currentLanguage=d,this.notifyListeners()}static getInstance(){if(!f.instance)f.instance=new f;return f.instance}getLocale(){return{...t.find((h)=>h.code===this.currentLanguage)||t[0],translations:this.cache.get(this.currentLanguage)||{}}}getAvailableLocales(){return t}async loadLocale(g){if(this.cache.has(g))return;try{let h=await fetch(`/locales/${g}.json?v=${new Date().getTime()}`);if(!h.ok)throw Error(`Failed to load locale ${g}`);let d=await h.json();this.cache.set(g,d)}catch(h){console.error(h)}}async setLanguage(g){if(t.find((h)=>h.code===g))await this.loadLocale(g),this.currentLanguage=g,localStorage.setItem("csh_lang",g),this.notifyListeners();else console.warn(`[I18n] Language ${g} not supported`)}t(g,h){let d=this.cache.get(this.currentLanguage),a=this.cache.get("en"),m=d?.[g];if(!m&&a)m=a[g];if(!m)return g;if(h)Object.keys(h).forEach((E)=>{m=m.replace(`{${E}}`,h[E])});return m}subscribe(g){return this.listeners.push(g),g(this.getLocale()),()=>{this.listeners=this.listeners.filter((h)=>h!==g)}}notifyListeners(){let g=this.getLocale();this.listeners.forEach((h)=>h(g))}async ensureInitialized(){return this.initialized}}var o=f.getInstance();async function i(g){try{await o.ensureInitialized(),await g()}catch(h){console.error("[Bootstrap] Critical failure:",h),document.body.innerHTML=`
            <div style="
                display: flex; 
                flex-direction: column; 
                align-items: center; 
                justify-content: center; 
                height: 100vh; 
                background: #111; 
                color: #fff; 
                font-family: sans-serif;
                text-align: center;
            ">
                <h1 style="color: #fa5252;">System Error</h1>
                <p>Failed to initialize application resources.</p>
                <p style="opacity: 0.7; font-size: 0.9em;">Check console for details.</p>
                <button onclick="window.location.reload()" style="
                    margin-top: 20px;
                    padding: 10px 20px;
                    background: #333;
                    color: white;
                    border: 1px solid #555;
                    cursor: pointer;
                    border-radius: 4px;
                ">Reload</button>
            </div>
        `}}i(async()=>{let g=document.getElementById("loginForm"),h=document.getElementById("feedback"),d=document.getElementById("submitBtn"),a=document.querySelector(".setup-container");if(a)a.style.opacity="0",a.style.transition="opacity 0.3s ease";if(!g)return;S.init(),(()=>{let E=document.querySelector(".auth-title"),l=document.querySelector(".auth-subtitle"),_=document.querySelector('label[for="username"]'),A=document.querySelector('label[for="password"]');if(E)E.textContent=o.t("auth.welcome");if(l)l.textContent=o.t("auth.subtitle");if(_)_.textContent=o.t("auth.username");if(A)A.textContent=o.t("auth.password");if(d)d.textContent=o.t("auth.sign_in");requestAnimationFrame(()=>{if(a)a.style.opacity="1"})})(),g.addEventListener("keydown",(E)=>{if(E.key==="Enter");}),g.addEventListener("submit",async(E)=>{if(E.preventDefault(),h.style.display="none",h.textContent="",d){d.disabled=!0;let A=d.textContent;d.textContent=o.t("general.pinging")||"Signing in..."}let l=new FormData(g),_=Object.fromEntries(l.entries());try{let A=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});if(A.ok)window.location.href="/";else{let M=await A.text();if(h.textContent=M||o.t("auth.invalid_credentials"),h.style.display="block",d)d.disabled=!1,d.textContent=o.t("auth.sign_in");if(a)a.animate([{transform:"translateX(0)"},{transform:"translateX(-10px)"},{transform:"translateX(10px)"},{transform:"translateX(-10px)"},{transform:"translateX(0)"}],{duration:400,easing:"ease-in-out"})}}catch(A){if(console.error("Login error:",A),h.textContent=o.t("auth.connection_error"),h.style.display="block",d)d.disabled=!1,d.textContent=o.t("auth.sign_in")}})});
